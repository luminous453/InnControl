# InnControl - Система администрирования гостиниц

Проект представляет собой веб-приложение для администрирования гостиницы. Система позволяет управлять номерным фондом, бронированиями, клиентами, персоналом и расписанием уборок.

## Архитектура проекта

Проект построен на основе трёхуровневой архитектуры, которая разделяет приложение на независимые слои:

1. **Клиентская часть (Frontend)** - интерфейс пользователя, реализованный как SPA (Single Page Application)
2. **Серверная часть (Backend)** - RESTful API, обрабатывающее запросы клиента
3. **База данных** - хранилище информации о гостинице, номерах, клиентах и бронированиях

### Общая структура проекта

```
InnControl/
├── backend/           # Серверная часть на FastAPI
│   ├── main.py        # Основной файл с эндпоинтами API
│   ├── crud.py        # Функции для работы с данными
│   ├── models.py      # Модели данных (SQLAlchemy)
│   ├── schemas.py     # Схемы данных (Pydantic)
│   ├── database.py    # Настройка подключения к БД
│   ├── init_db.py     # Инициализация базы данных
│   └── run_server.py  # Скрипт запуска сервера
│
└── frontend/          # Клиентская часть на Next.js
    ├── app/           # Компоненты страниц приложения
    │   ├── dashboard/ # Панель администратора
    │   │   ├── rooms/     # Управление номерами
    │   │   ├── bookings/  # Управление бронированиями
    │   │   ├── clients/   # Управление клиентами
    │   │   ├── employees/ # Управление сотрудниками
    │   │   ├── cleaning/  # Управление уборкой
    │   │   ├── logs/      # Журнал уборок
    │   │   └── reports/   # Финансовые отчеты
    │   ├── page.tsx   # Главная страница (логин)
    │   ├── login/     # Страница авторизации
    │   └── layout.tsx # Общий макет приложения
    ├── services/      # Сервисы для работы с API
    └── components/    # Переиспользуемые компоненты
```

### Взаимодействие компонентов

1. Пользователь взаимодействует с клиентским приложением через браузер
2. Клиентское приложение отправляет запросы к REST API через сервисы
3. Серверная часть обрабатывает запросы, взаимодействует с базой данных и возвращает результаты
4. Клиентское приложение обновляет интерфейс в соответствии с полученными данными

## Технологический стек

Проект разделен на две части:
- **frontend** - клиентская часть, разработанная на Next.js с использованием React и Tailwind CSS
- **backend** - серверная часть, разработанная на FastAPI с использованием SQLAlchemy для работы с базой данных PostgreSQL

### Преимущества выбранного стека

1. **Next.js и React** - позволяют создать быстрый и отзывчивый пользовательский интерфейс с компонентным подходом
2. **Tailwind CSS** - упрощает создание современного дизайна без необходимости писать кастомный CSS
3. **FastAPI** - высокопроизводительный фреймворк для создания API с автоматической генерацией Swagger-документации
4. **SQLAlchemy** - мощный ORM для работы с различными базами данных
5. **PostgreSQL** - надежная и масштабируемая реляционная база данных с поддержкой сложных запросов

### Frontend
- Next.js 14.0.1
- React 18
- TypeScript 5
- Tailwind CSS 3.3.0
- React Hook Form 7.48.2
- React Datepicker 4.21.0
- React Icons 4.11.0
- date-fns 2.30.0
- ESLint 8

### Backend
- FastAPI 0.104.0
- Uvicorn 0.23.2
- SQLAlchemy 2.0.22
- Pydantic 2.4.2
- Pydantic-settings 2.0.3
- PostgreSQL (psycopg2-binary 2.9.9)
- Passlib 1.7.4 для хеширования паролей
- Python-jose 3.3.0 для работы с токенами
- Python-dotenv 1.0.0 для работы с переменными окружения
- Bcrypt 4.0.1 для шифрования
- Python-multipart 0.0.6 для обработки форм

## Подключение к базе данных

Проект использует PostgreSQL в качестве основной базы данных. Подключение настраивается через переменные окружения:

1. Создайте файл `.env` в директории `backend` со следующими параметрами:
   ```
   POSTGRES_USER=postgres
   POSTGRES_PASSWORD=ваш_пароль
   POSTGRES_SERVER=localhost
   POSTGRES_PORT=5432
   POSTGRES_DB=inncontrol
   ```

2. Настройка подключения происходит в файле `database.py`:
   ```python
   # Получаем данные для подключения из переменных окружения или используем значения по умолчанию
   POSTGRES_USER = os.getenv("POSTGRES_USER", "postgres")
   POSTGRES_PASSWORD = os.getenv("POSTGRES_PASSWORD", "postgres")
   POSTGRES_SERVER = os.getenv("POSTGRES_SERVER", "localhost")
   POSTGRES_PORT = os.getenv("POSTGRES_PORT", "5432")
   POSTGRES_DB = os.getenv("POSTGRES_DB", "inncontrol")

   # Строка подключения к базе данных
   SQLALCHEMY_DATABASE_URL = f"postgresql://{POSTGRES_USER}:{POSTGRES_PASSWORD}@{POSTGRES_SERVER}:{POSTGRES_PORT}/{POSTGRES_DB}"
   ```

3. Перед запуском приложения необходимо создать базу данных PostgreSQL с именем `inncontrol`.

## Установка и запуск

### Быстрый старт

1. Клонируйте репозиторий
   ```bash
   git clone https://github.com/luminous453/InnControl.git
   cd InnControl
   ```

2. Создайте базу данных PostgreSQL с именем `inncontrol`

3. Запустите backend
   ```bash
   cd backend
   pip install -r requirements.txt
   uvicorn main:app --reload
   ```

4. Запустите frontend
   ```bash
   cd frontend
   npm install
   npm run dev
   ```

5. Откройте браузер и перейдите по адресу http://localhost:3000

### Подробная инструкция

#### Backend

1. Перейдите в директорию backend
   ```bash
   cd backend
   ```

2. Создайте и активируйте виртуальное окружение Python
   ```bash
   # Windows
   python -m venv venv
   venv\Scripts\activate
   
   # Linux/Mac
   python3 -m venv venv
   source venv/bin/activate
   ```

3. Установите зависимости
   ```bash
   pip install -r requirements.txt
   ```

4. Создайте файл .env с настройками подключения к PostgreSQL
   ```bash
   python create_env.py
   ```
   или вручную создайте файл .env со следующим содержимым:
   ```
   POSTGRES_USER=postgres
   POSTGRES_PASSWORD=ваш_пароль
   POSTGRES_SERVER=localhost
   POSTGRES_PORT=5432
   POSTGRES_DB=inncontrol
   ```

5. Запустите сервер
   ```bash
   # Запуск с инициализацией базы данных
   python run_server.py
   
   # Или просто запуск API без инициализации
   uvicorn main:app --reload
   ```
   
   Backend API будет доступен по адресу http://localhost:8000
   Документация API доступна по адресу http://localhost:8000/docs

#### Frontend

1. Перейдите в директорию frontend
   ```bash
   cd frontend
   ```

2. Установите зависимости
   ```bash
   npm install
   ```

3. Запустите сервер разработки
   ```bash
   npm run dev
   ```
   
   Клиентское приложение будет доступно по адресу http://localhost:3000

## Аутентификация

В проекте используется простая аутентификация с хешированием паролей:

1. Пароли хешируются с использованием библиотеки `passlib` и алгоритма `bcrypt`
2. При входе пользователь получает простой токен доступа в формате `username_id`
3. Токен добавляется в заголовок `Authorization` при запросах к API с префиксом `Bearer`

Для входа в систему используйте:
- Логин: `admin`
- Пароль: `admin`

## Инициализация базы данных

При первом запуске через `run_server.py` автоматически создаются:
- Гостиница "Маяк"
- Пользователь `admin` с паролем `admin`

## Реализованные функции

### Управление номерным фондом
- Просмотр списка всех номеров
- Фильтрация по типу номера и статусу
- Добавление новых номеров
- Редактирование информации о номере
- Автоматическое управление статусом номера (Свободен/Занят) на основе бронирований
- Просмотр истории бронирований номера

### Управление клиентами
- Просмотр списка клиентов с информацией о бронированиях
- Поиск клиентов по имени или паспортным данным
- Фильтрация по городу проживания
- Добавление новых клиентов

### Управление бронированиями
- Просмотр всех бронирований
- Фильтрация по статусу
- Создание новых бронирований с проверкой доступности номеров
- Автоматический расчет стоимости бронирования
- Автоматическое обновление статуса номера при создании/изменении/удалении бронирования

### Управление персоналом
- Просмотр списка сотрудников
- Добавление новых сотрудников
- Изменение статуса сотрудников (активен, в отпуске, уволен)
- Редактирование данных сотрудника (должность, контактная информация)
- Удаление сотрудников из базы данных

### Управление уборками
- Просмотр расписания уборок по дням недели и этажам
- Просмотр журнала уборок с информацией о номере и сотруднике
- Фильтрация записей по дате, статусу и сотруднику
- Добавление новых записей в журнал уборок

### Аналитика и отчёты
- Информационная панель с ключевыми метриками гостиницы
- Отображение общей заполняемости гостиницы
- Отображение статистики по номерам и бронированиям
- Средний рейтинг гостиницы (4.8)
- Финансовые отчеты по бронированиям с возможностью экспорта в PDF

## Основные API-эндпоинты

- `/token` - получение токена доступа
  - `POST /token` - аутентификация пользователя

- `/api/dashboard/recent-bookings` - получение последних бронирований для дашборда с деталями

- `/employees/` - управление сотрудниками
  - `GET /employees/` - получение списка всех сотрудников
  - `POST /employees/` - добавление нового сотрудника
  - `PUT /employees/{employee_id}` - обновление данных сотрудника
  - `DELETE /employees/{employee_id}` - удаление сотрудника

- `/clients/` - управление клиентами
  - `GET /clients/` - получение списка всех клиентов
  - `POST /clients/` - добавление нового клиента
  - `PUT /clients/{client_id}` - обновление данных клиента
  - `DELETE /clients/{client_id}` - удаление клиента

- `/rooms/` - управление номерами
  - `GET /rooms/` - получение списка всех номеров
  - `POST /rooms/` - добавление нового номера
  - `PUT /rooms/{room_id}` - обновление данных номера
  - `GET /available-rooms/` - получение списка доступных номеров
  - `POST /update-room-statuses/` - автоматическое обновление статусов номеров

- `/bookings/` - управление бронированиями
  - `GET /bookings/` - получение списка всех бронирований
  - `POST /bookings/` - создание нового бронирования
  - `PUT /bookings/{booking_id}` - обновление данных бронирования
  - `PUT /bookings/{booking_id}/status` - изменение статуса бронирования

Полный список эндпоинтов доступен в Swagger UI документации по адресу http://localhost:8000/docs 